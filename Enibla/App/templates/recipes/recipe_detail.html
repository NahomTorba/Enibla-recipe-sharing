{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ recipe.title }} - Enibla Recipe Sharing</title>
    <meta name="description" content="{{ recipe.description|truncatewords:30 }}">
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="{{ recipe.title }}">
    <meta property="og:description" content="{{ recipe.description|truncatewords:30 }}">
    <meta property="og:image" content="{% if recipe.image %}{{ request.build_absolute_uri:recipe.image.url }}{% endif %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="article">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ recipe.title }}">
    <meta name="twitter:description" content="{{ recipe.description|truncatewords:30 }}">
    <meta name="twitter:image" content="{% if recipe.image %}{{ request.build_absolute_uri:recipe.image.url }}{% endif %}">
    
    <link rel="stylesheet" href="{% static 'css/recipe_detail.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="{% url 'home' %}" class="nav-brand">
                <i class="fas fa-utensils"></i>
                Enibla Recipes
            </a>
            <div class="nav-menu">
                <a href="{% url 'recipe_list' %}" class="nav-link">All Recipes</a>
                <a href="{% url 'recipe_create' %}" class="nav-link">Add Recipe</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'profile' %}" class="nav-link">My Profile</a>
                    <a href="{% url 'logout' %}" class="nav-link">Logout</a>
                {% else %}
                    <a href="{% url 'login' %}" class="nav-link">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{% url 'home' %}">Home</a>
            <span class="breadcrumb-separator">/</span>
            <a href="{% url 'recipe_list' %}">Recipes</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">{{ recipe.title }}</span>
        </nav>

        <!-- Recipe Header -->
        <div class="recipe-header">
            <div class="recipe-title-section">
                <h1 class="recipe-title">{{ recipe.title }}</h1>
                <div class="recipe-rating">
                    <div class="stars" data-rating="{{ recipe.average_rating|floatformat:1 }}">
                        {% for i in "12345" %}
                            <i class="fas fa-star"></i>
                        {% endfor %}
                    </div>
                    <span class="rating-text">({{ recipe.reviews.count }} reviews)</span>
                </div>
            </div>
            
            <div class="recipe-actions">
                <button class="btn btn-primary" id="shareBtn">
                    <i class="fas fa-share-alt"></i> Share
                </button>
                <button class="btn btn-secondary" id="saveBtn" data-recipe-id="{{ recipe.id }}">
                    <i class="fas fa-bookmark"></i> Save
                </button>
                <button class="btn btn-secondary" onclick="window.print()">
                    <i class="fas fa-print"></i> Print
                </button>
                {% if user.userprofile == recipe.author %}
                    <a href="{% url 'recipe_edit' recipe.pk %}" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Edit
                    </a>
                {% endif %}
            </div>
        </div>

        <!-- Recipe Meta Info -->
        <div class="recipe-meta">
            <div class="meta-item">
                <i class="fas fa-user"></i>
                <span>By <a href="{% url 'user_profile' recipe.author.user.username %}">{{ recipe.author.user.get_full_name|default:recipe.author.user.username }}</a></span>
            </div>
            <div class="meta-item">
                <i class="fas fa-calendar"></i>
                <span>{{ recipe.created_at|date:"F d, Y" }}</span>
            </div>
            <div class="meta-item">
                <i class="fas fa-clock"></i>
                <span>Updated {{ recipe.updated_at|date:"M d, Y" }}</span>
            </div>
        </div>

        <!-- Recipe Image -->
        {% if recipe.image %}
        <div class="recipe-image-container">
            <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image" id="recipeImage">
            <div class="image-overlay">
                <button class="btn btn-light" id="fullscreenBtn">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
        </div>
        {% endif %}

        <!-- Recipe Content -->
        <div class="recipe-content">
            <!-- Left Sidebar -->
            <div class="recipe-sidebar">
                <!-- Tags -->
                {% if recipe.tags %}
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="fas fa-tags"></i> Categories
                    </h3>
                    <div class="tags-container">
                        {% for tag in recipe.get_tag_choices_list %}
                        <span class="tag">{{ tag|title }}</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Ingredients -->
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="fas fa-list-ul"></i> Ingredients
                    </h3>
                    <div class="ingredients-content">
                        {{ recipe.ingredients|linebreaks }}
                    </div>
                    <div class="ingredients-checklist" id="ingredientsList">
                        <!-- JavaScript will populate this with checkboxes -->
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="recipe-main">
                <!-- Description -->
                {% if recipe.description %}
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i> About This Recipe
                    </h3>
                    <p class="recipe-description">{{ recipe.description|linebreaks }}</p>
                </div>
                {% endif %}

                <!-- Instructions -->
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="fas fa-list-ol"></i> Instructions
                        <button class="btn-small" id="timerBtn">
                            <i class="fas fa-stopwatch"></i> Timer
                        </button>
                    </h3>
                    <div class="cooking-timer" id="cookingTimer" style="display: none;">
                        <div class="timer-display">
                            <span id="timerDisplay">00:00</span>
                            <div class="timer-controls">
                                <button class="btn btn-small" id="startTimer">Start</button>
                                <button class="btn btn-small" id="pauseTimer">Pause</button>
                                <button class="btn btn-small" id="resetTimer">Reset</button>
                            </div>
                        </div>
                    </div>
                    <div class="instructions-content">
                        {{ recipe.instructions|linebreaks }}
                    </div>
                    <div class="instructions-checklist" id="instructionsList">
                        <!-- JavaScript will populate this with interactive steps -->
                    </div>
                </div>

                <!-- Reviews Section -->
                <div class="section-card">
                    <h3 class="section-title">
                        <i class="fas fa-star"></i> Reviews ({{ recipe.reviews.count }})
                    </h3>
                    
                    <!-- Add Review Form -->
                    {% if user.is_authenticated %}
                    <div class="add-review">
                        <h4>Leave a Review</h4>
                        <form id="reviewForm" method="post" action="{% url 'add_review' recipe.pk %}">
                            {% csrf_token %}
                            <div class="rating-input">
                                <label>Rating:</label>
                                <div class="star-rating" id="starRating">
                                    {% for i in "12345" %}
                                    <i class="fas fa-star" data-rating="{{ i }}"></i>
                                    {% endfor %}
                                </div>
                                <input type="hidden" name="rating" id="ratingInput" required>
                            </div>
                            <textarea name="comment" placeholder="Share your thoughts about this recipe..." rows="4"></textarea>
                            <button type="submit" class="btn btn-primary">Submit Review</button>
                        </form>
                    </div>
                    {% endif %}

                    <!-- Reviews List -->
                    <div class="reviews-list">
                        {% for review in recipe.reviews.all|slice:":5" %}
                        <div class="review-item">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <strong>{{ review.user.get_full_name|default:review.user.username }}</strong>
                                    <div class="review-rating">
                                        {% for i in "12345" %}
                                        <i class="fas fa-star {% if i|add:0 <= review.rating %}active{% endif %}"></i>
                                        {% endfor %}
                                    </div>
                                </div>
                                <span class="review-date">{{ review.created_at|date:"M d, Y" }}</span>
                            </div>
                            <p class="review-comment">{{ review.comment }}</p>
                        </div>
                        {% empty %}
                        <p class="no-reviews">No reviews yet. Be the first to review this recipe!</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Recipes -->
        {% if related_recipes %}
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas fa-heart"></i> You Might Also Like
            </h3>
            <div class="related-recipes">
                {% for related in related_recipes %}
                <div class="recipe-card">
                    <a href="{% url 'recipe_detail' related.pk %}">
                        {% if related.image %}
                        <img src="{{ related.image.url }}" alt="{{ related.title }}" class="recipe-card-image">
                        {% endif %}
                        <div class="recipe-card-content">
                            <h4 class="recipe-card-title">{{ related.title }}</h4>
                            <div class="recipe-card-meta">
                                <span><i class="fas fa-user"></i> {{ related.author.user.username }}</span>
                                <span><i class="fas fa-star"></i> {{ related.average_rating|floatformat:1 }}</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Share Modal -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Share This Recipe</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <button class="share-btn facebook" data-platform="facebook">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                    <button class="share-btn twitter" data-platform="twitter">
                        <i class="fab fa-twitter"></i> Twitter
                    </button>
                    <button class="share-btn pinterest" data-platform="pinterest">
                        <i class="fab fa-pinterest"></i> Pinterest
                    </button>
                    <button class="share-btn whatsapp" data-platform="whatsapp">
                        <i class="fab fa-whatsapp"></i> WhatsApp
                    </button>
                </div>
                <div class="share-link">
                    <label for="shareUrl">Recipe Link:</label>
                    <div class="link-container">
                        <input type="text" id="shareUrl" value="{{ request.build_absolute_uri }}" readonly>
                        <button class="btn btn-primary" id="copyLink">Copy</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button class="scroll-to-top" id="scrollToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="{% static 'js/recipe_detail.js' %}"></script>
</body>
</html>
