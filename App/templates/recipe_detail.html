{% extends 'base.html' %}
{% load recipe_filters %}

{% block title %}{{ recipe.title }} - Recipe Details{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="mb-0">{{ recipe.title }}</h2>
                        {% if user.is_authenticated and recipe.author.user == user %}
                            <div>
                                <a href="{% url 'edit_recipe' recipe.slug %}" class="btn btn-sm btn-warning me-2">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <form action="{% url 'delete_recipe' recipe.slug %}" method="post" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this recipe?')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            {% if recipe.image %}
                            <img src="{{ recipe.image.url }}" class="img-fluid rounded mb-3" alt="{{ recipe.title }}">
                            {% else %}
                            <div class="recipe-placeholder rounded mb-3">
                                <i class="fas fa-utensils fa-5x text-muted"></i>
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <div class="mb-4">
                                <h4 class="mb-3">Ingredients:</h4>
                                <div class="ingredients-list">
                                    {{ recipe.ingredients|linebreaks }}
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4 class="mb-3">Instructions:</h4>
                                <div class="instructions">
                                    {{ recipe.description|linebreaks }}
                                </div>
                            </div>
                            
                            <div class="tags-section mb-4">
                                <h4 class="mb-3">Tags:</h4>
                                <div class="tags-container">
                                    {% if recipe.tags %}
                                        {% for tag in recipe.get_tag_choices_list %}
                                            <span class="tag-badge">
                                                <i class="fas fa-tag"></i> {{ tag|title }}
                                            </span>
                                        {% endfor %}
                                    {% else %}
                                        <span class="text-muted">No tags added</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="recipe-meta">
                                <div class="d-flex gap-3">
                                    <div>
                                        <i class="fas fa-user me-1"></i>
                                        <strong>Author:</strong> {{ recipe.author.user.get_full_name }}
                                    </div>
                                    <div>
                                        <i class="fas fa-calendar me-1"></i>
                                        <strong>Created:</strong> {{ recipe.created_at|timesince }} ago
                                    </div>
                                    <div>
                                        <i class="fas fa-clock me-1"></i>
                                        <strong>Last Updated:</strong> {{ recipe.updated_at|timesince }} ago
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer bg-white border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{% url 'index' %}" class="btn btn-outline-primary">
                            <i class="fas fa-arrow-left me-1"></i> Back to Home
                        </a>
                        <a href="{% url 'profile_detail' username=recipe.author.user.username %}" class="btn btn-outline-secondary">
                            <i class="fas fa-user me-1"></i> View Author Profile
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Related Recipes -->
            {% if related_recipes %}
            <div class="mt-5">
                <h3 class="mb-4"><i class="fas fa-link me-2"></i>Related Recipes</h3>
                <div class="row g-4">
                    {% for related in related_recipes %}
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-2">
                                    <a href="{% url 'recipe_detail' related.slug %}" class="text-decoration-none">
                                        {{ related.title }}
                                    </a>
                                </h5>
                                <p class="card-text text-muted mb-3">
                                    {{ related.description|truncatewords:20 }}
                                </p>
                                <div class="tags-container mb-3">
                                    {% for tag in related.get_tag_choices_list %}
                                        {% if tag %}
                                            <span class="tag-badge">
                                                <i class="fas fa-{% if tag == 'Breakfast' %}coffee{% elif tag == 'Lunch' %}hamburger{% elif tag == 'Dinner' %}utensils{% elif tag == 'Dessert' %}ice-cream{% elif tag == 'Snack' %}cookie-bite{% elif tag == 'Fasting' %}moon{% endif %}"></i>
                                                {{ tag }}
                                            </span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <div class="recipe-meta text-muted">
                                    <i class="fas fa-user me-1"></i>
                                    {{ related.author.user.get_full_name }} â€¢ 
                                    <i class="fas fa-calendar me-1"></i>
                                    {{ related.created_at|timesince }} ago
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
